import{r as m,c as d,j as r}from"./index-DkIiY9Ul.js";import{a as x,l as _}from"./axios-BITR5ggg.js";import{B as v,Q as y,h as p,u as N}from"./useInterval-CVVbvUix.js";var j={},O=d&&d.__createBinding||(Object.create?function(e,a,n,o){o===void 0&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return a[n]}})}:function(e,a,n,o){o===void 0&&(o=n),e[o]=a[n]}),w=d&&d.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),C=d&&d.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&O(a,e,n);return w(a,e),a};Object.defineProperty(j,"__esModule",{value:!0});var c=C(m);function S(e){var a=c.useState(0),n=a[0],o=a[1],l=e.transitionDuration||400,t=e.delay||50,f=e.wrapperTag||"div",s=e.childTag||"div",u=typeof e.visible>"u"?!0:e.visible;return c.useEffect(function(){var i=c.default.Children.count(e.children);if(u||(i=0),i==n){var h=setTimeout(function(){e.onComplete&&e.onComplete()},l);return function(){return clearTimeout(h)}}var b=i>n?1:-1,g=setTimeout(function(){o(n+b)},t);return function(){return clearTimeout(g)}},[c.default.Children.count(e.children),t,n,u,l]),c.default.createElement(f,{className:e.className},c.default.Children.map(e.children,function(i,h){return c.default.createElement(s,{className:e.childClassName,style:{transition:"opacity "+l+"ms, transform "+l+"ms",transform:n>h?"none":"translateY(20px)",opacity:n>h?1:0}},i)}))}var T=j.default=S;p.locale("ru");function k(){const a=new URLSearchParams(window.location.search).get("key"),[n,o]=m.useState([]);m.useEffect(()=>{(async()=>{try{const{data:t}=await x.get(`https://api.tipmeadollar.com/public/donations?page=1&limit=25&token=${a}`);o(t.donations.data)}catch{v.error("произошла неизвестная ошибка!")}})()},[]),m.useEffect(()=>{const t=_("https://socket.tipmeadollar.com",{reconnection:!0,reconnectionDelayMax:5e3,reconnectionDelay:1e3});return t.on("connect",()=>{console.log("Connected to Socket.IO server"),t.emit("authenticate",JSON.stringify({token:a,ignoreNew:!0}))}),t.on("donations:new",f=>{const s=JSON.parse(f);console.log("New donation received",s),o(u=>u.find(i=>i.id===s.donation.id)?u:[s.donation,...u])}),()=>{t.disconnect()}},[a]);const l=({donation:t})=>{const[f,s]=m.useState(p(t.paid_at).fromNow());return N(()=>{s(p(t.paid_at).fromNow())},1e3),r.jsx(T,{children:r.jsxs("div",{className:"donation",children:[r.jsxs("p",{className:"donation-title",children:[r.jsx("b",{children:t.name||"аноним"})," отправил"," ",r.jsxs("b",{children:[t.amount/100," ",t.currency]})]}),t.message&&r.jsx("p",{className:"donation-message",children:t.message}),t.audio&&r.jsx("audio",{controls:!0,src:t.audio}),r.jsx("p",{className:"donation-date",children:f})]})})};return r.jsxs("div",{className:"donation-list",children:[r.jsx(y,{position:"bottom-center",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,toastStyle:{backgroundColor:"#202020"},rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"dark"}),n.length===0?r.jsx("div",{className:"not-found",children:r.jsx("p",{className:"not-found-text",children:"донатов не найдено"})}):r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"skip-button",onClick:async()=>{try{await x.post("https://api.tipmeadollar.com/public/donations/skip_current",{token:a}),v.success("донат пропущен!")}catch{v.error("произошла неизвестная ошибка!")}},children:"пропустить текущий донат"}),n.map(t=>r.jsx(l,{donation:t}))]})]})}export{k as default};
