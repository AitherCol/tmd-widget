import{r as c,c as f,j as s}from"./index-1R6F1rt7.js";import{a as L,l as x}from"./axios-BITR5ggg.js";import{h as v,B as p,Q as T}from"./ReactToastify-BnefOgYr.js";//! moment.js locale configuration
//! locale : Russian [ru]
//! author : Viktorminator : https://github.com/Viktorminator
//! author : Menelion Elensúle : https://github.com/Oire
//! author : Коренберг Марк : https://github.com/socketpair
function j(e,t){var a=e.split("_");return t%10===1&&t%100!==11?a[0]:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?a[1]:a[2]}function o(e,t,a){var n={ss:t?"секунда_секунды_секунд":"секунду_секунды_секунд",mm:t?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",ww:"неделя_недели_недель",MM:"месяц_месяца_месяцев",yy:"год_года_лет"};return a==="m"?t?"минута":"минуту":e+" "+j(n[a],+e)}var y=[/^янв/i,/^фев/i,/^мар/i,/^апр/i,/^ма[йя]/i,/^июн/i,/^июл/i,/^авг/i,/^сен/i,/^окт/i,/^ноя/i,/^дек/i];v.defineLocale("ru",{months:{format:"января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_"),standalone:"январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_")},monthsShort:{format:"янв._февр._мар._апр._мая_июня_июля_авг._сент._окт._нояб._дек.".split("_"),standalone:"янв._февр._март_апр._май_июнь_июль_авг._сент._окт._нояб._дек.".split("_")},weekdays:{standalone:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),format:"воскресенье_понедельник_вторник_среду_четверг_пятницу_субботу".split("_"),isFormat:/\[ ?[Вв] ?(?:прошлую|следующую|эту)? ?] ?dddd/},weekdaysShort:"вс_пн_вт_ср_чт_пт_сб".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),monthsParse:y,longMonthsParse:y,shortMonthsParse:y,monthsRegex:/^(январ[ья]|янв\.?|феврал[ья]|февр?\.?|марта?|мар\.?|апрел[ья]|апр\.?|ма[йя]|июн[ья]|июн\.?|июл[ья]|июл\.?|августа?|авг\.?|сентябр[ья]|сент?\.?|октябр[ья]|окт\.?|ноябр[ья]|нояб?\.?|декабр[ья]|дек\.?)/i,monthsShortRegex:/^(январ[ья]|янв\.?|феврал[ья]|февр?\.?|марта?|мар\.?|апрел[ья]|апр\.?|ма[йя]|июн[ья]|июн\.?|июл[ья]|июл\.?|августа?|авг\.?|сентябр[ья]|сент?\.?|октябр[ья]|окт\.?|ноябр[ья]|нояб?\.?|декабр[ья]|дек\.?)/i,monthsStrictRegex:/^(январ[яь]|феврал[яь]|марта?|апрел[яь]|ма[яй]|июн[яь]|июл[яь]|августа?|сентябр[яь]|октябр[яь]|ноябр[яь]|декабр[яь])/i,monthsShortStrictRegex:/^(янв\.|февр?\.|мар[т.]|апр\.|ма[яй]|июн[ья.]|июл[ья.]|авг\.|сент?\.|окт\.|нояб?\.|дек\.)/i,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., H:mm",LLLL:"dddd, D MMMM YYYY г., H:mm"},calendar:{sameDay:"[Сегодня, в] LT",nextDay:"[Завтра, в] LT",lastDay:"[Вчера, в] LT",nextWeek:function(e){if(e.week()!==this.week())switch(this.day()){case 0:return"[В следующее] dddd, [в] LT";case 1:case 2:case 4:return"[В следующий] dddd, [в] LT";case 3:case 5:case 6:return"[В следующую] dddd, [в] LT"}else return this.day()===2?"[Во] dddd, [в] LT":"[В] dddd, [в] LT"},lastWeek:function(e){if(e.week()!==this.week())switch(this.day()){case 0:return"[В прошлое] dddd, [в] LT";case 1:case 2:case 4:return"[В прошлый] dddd, [в] LT";case 3:case 5:case 6:return"[В прошлую] dddd, [в] LT"}else return this.day()===2?"[Во] dddd, [в] LT":"[В] dddd, [в] LT"},sameElse:"L"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",ss:o,m:o,mm:o,h:"час",hh:o,d:"день",dd:o,w:"неделя",ww:o,M:"месяц",MM:o,y:"год",yy:o},meridiemParse:/ночи|утра|дня|вечера/i,isPM:function(e){return/^(дня|вечера)$/.test(e)},meridiem:function(e,t,a){return e<4?"ночи":e<12?"утра":e<17?"дня":"вечера"},dayOfMonthOrdinalParse:/\d{1,2}-(й|го|я)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":return e+"-й";case"D":return e+"-го";case"w":case"W":return e+"-я";default:return e}},week:{dow:1,doy:4}});var M={},D=f&&f.__createBinding||(Object.create?function(e,t,a,n){n===void 0&&(n=a),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,n){n===void 0&&(n=a),e[n]=t[a]}),k=f&&f.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),b=f&&f.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var a in e)a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)&&D(t,e,a);return k(t,e),t};Object.defineProperty(M,"__esModule",{value:!0});var u=b(c);function N(e){var t=u.useState(0),a=t[0],n=t[1],i=e.transitionDuration||400,r=e.delay||50,m=e.wrapperTag||"div",l=e.childTag||"div",_=typeof e.visible>"u"?!0:e.visible;return u.useEffect(function(){var d=u.default.Children.count(e.children);if(_||(d=0),d==a){var h=setTimeout(function(){e.onComplete&&e.onComplete()},i);return function(){return clearTimeout(h)}}var w=d>a?1:-1,g=setTimeout(function(){n(a+w)},r);return function(){return clearTimeout(g)}},[u.default.Children.count(e.children),r,a,_,i]),u.default.createElement(m,{className:e.className},u.default.Children.map(e.children,function(d,h){return u.default.createElement(l,{className:e.childClassName,style:{transition:"opacity "+i+"ms, transform "+i+"ms",transform:a>h?"none":"translateY(20px)",opacity:a>h?1:0}},d)}))}var Y=M.default=N;function O(e,t){const a=c.useRef(null);c.useEffect(()=>{a.current=e}),c.useEffect(()=>{function n(){a.current!==null&&a.current()}const i=setInterval(n,t);return()=>clearInterval(i)},[t])}v.locale("ru");function E(){const t=new URLSearchParams(window.location.search).get("key"),[a,n]=c.useState([]);c.useEffect(()=>{(async()=>{try{const{data:r}=await L.get(`https://api.tipmeadollar.com/internal/socket/donations?page=1&limit=25&token=${t}`);n(r.donations.data)}catch{p.error("произошла неизвестная ошибка!")}})()},[]),c.useEffect(()=>{const r=x("https://socket.tipmeadollar.com",{reconnection:!0,reconnectionDelayMax:5e3,reconnectionDelay:1e3});return r.on("connect",()=>{console.log("Connected to Socket.IO server"),r.emit("authenticate",JSON.stringify({token:t,ignoreNew:!0}))}),r.on("donations:new",m=>{const l=JSON.parse(m);console.log("New donation received",l),n(_=>_.find(d=>d.id===l.donation.id)?_:[l.donation,..._])}),()=>{r.disconnect()}},[t]);const i=({donation:r})=>{const[m,l]=c.useState(v(r.paid_at).fromNow());return O(()=>{l(v(r.paid_at).fromNow())},1e3),s.jsx(Y,{children:s.jsxs("div",{className:"donation",children:[s.jsxs("p",{className:"donation-title",children:[s.jsx("b",{children:r.name||"аноним"})," отправил"," ",s.jsxs("b",{children:[r.amount/100," ",r.currency]})]}),r.message&&s.jsx("p",{className:"donation-message",children:r.message}),r.audio&&s.jsx("audio",{controls:!0,src:r.audio}),s.jsx("p",{className:"donation-date",children:m})]})})};return s.jsxs("div",{className:"donation-list",children:[s.jsx(T,{position:"bottom-center",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,toastStyle:{backgroundColor:"#202020"},rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"dark"}),a.length===0?s.jsx("div",{className:"not-found",children:s.jsx("p",{className:"not-found-text",children:"донатов не найдено"})}):s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"skip-button",onClick:async()=>{try{await L.post("https://api.tipmeadollar.com/internal/socket/skip",{token:t}),p.success("донат пропущен!")}catch{p.error("произошла неизвестная ошибка!")}},children:"пропустить текущий донат"}),a.map(r=>s.jsx(i,{donation:r}))]})]})}export{E as default};
