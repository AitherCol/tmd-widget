import{r as i,c as f,j as r}from"./index-L16_1XZR.js";import{a as x,l as _}from"./axios-BITR5ggg.js";import{B as v,Q as y,h as p}from"./ReactToastify-DmnqFPZm.js";var j={},N=f&&f.__createBinding||(Object.create?function(e,a,t,s){s===void 0&&(s=t),Object.defineProperty(e,s,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,s){s===void 0&&(s=t),e[s]=a[t]}),C=f&&f.__setModuleDefault||(Object.create?function(e,a){Object.defineProperty(e,"default",{enumerable:!0,value:a})}:function(e,a){e.default=a}),O=f&&f.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(e!=null)for(var t in e)t!=="default"&&Object.prototype.hasOwnProperty.call(e,t)&&N(a,e,t);return C(a,e),a};Object.defineProperty(j,"__esModule",{value:!0});var u=O(i);function w(e){var a=u.useState(0),t=a[0],s=a[1],o=e.transitionDuration||400,n=e.delay||50,m=e.wrapperTag||"div",c=e.childTag||"div",d=typeof e.visible>"u"?!0:e.visible;return u.useEffect(function(){var l=u.default.Children.count(e.children);if(d||(l=0),l==t){var h=setTimeout(function(){e.onComplete&&e.onComplete()},o);return function(){return clearTimeout(h)}}var g=l>t?1:-1,b=setTimeout(function(){s(t+g)},n);return function(){return clearTimeout(b)}},[u.default.Children.count(e.children),n,t,d,o]),u.default.createElement(m,{className:e.className},u.default.Children.map(e.children,function(l,h){return u.default.createElement(c,{className:e.childClassName,style:{transition:"opacity "+o+"ms, transform "+o+"ms",transform:t>h?"none":"translateY(20px)",opacity:t>h?1:0}},l)}))}var k=j.default=w;function S(e,a){const t=i.useRef(null);i.useEffect(()=>{t.current=e}),i.useEffect(()=>{function s(){t.current!==null&&t.current()}const o=setInterval(s,a);return()=>clearInterval(o)},[a])}p.locale("ru");function P(){const a=new URLSearchParams(window.location.search).get("key"),[t,s]=i.useState([]);i.useEffect(()=>{(async()=>{try{const{data:n}=await x.get(`https://api.tipmeadollar.com/internal/socket/donations?page=1&limit=25&token=${a}`);s(n.donations.data)}catch{v.error("произошла неизвестная ошибка!")}})()},[]),i.useEffect(()=>{const n=_("https://socket.tipmeadollar.com",{reconnection:!0,reconnectionDelayMax:5e3,reconnectionDelay:1e3});return n.on("connect",()=>{console.log("Connected to Socket.IO server"),n.emit("authenticate",JSON.stringify({token:a,ignoreNew:!0}))}),n.on("donations:new",m=>{const c=JSON.parse(m);console.log("New donation received",c),s(d=>d.find(l=>l.id===c.donation.id)?d:[c.donation,...d])}),()=>{n.disconnect()}},[a]);const o=({donation:n})=>{const[m,c]=i.useState(p(n.paid_at).fromNow());return S(()=>{c(p(n.paid_at).fromNow())},1e3),r.jsx(k,{children:r.jsxs("div",{className:"donation",children:[r.jsxs("p",{className:"donation-title",children:[r.jsx("b",{children:n.name||"аноним"})," отправил"," ",r.jsxs("b",{children:[n.amount/100," ",n.currency]})]}),n.message&&r.jsx("p",{className:"donation-message",children:n.message}),n.audio&&r.jsx("audio",{controls:!0,src:n.audio}),r.jsx("p",{className:"donation-date",children:m})]})})};return r.jsxs("div",{className:"donation-list",children:[r.jsx(y,{position:"bottom-center",autoClose:5e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,toastStyle:{backgroundColor:"#202020"},rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"dark"}),t.length===0?r.jsx("div",{className:"not-found",children:r.jsx("p",{className:"not-found-text",children:"донатов не найдено"})}):r.jsxs(r.Fragment,{children:[r.jsx("button",{className:"skip-button",onClick:async()=>{try{await x.post("https://api.tipmeadollar.com/internal/socket/skip",{token:a}),v.success("донат пропущен!")}catch{v.error("произошла неизвестная ошибка!")}},children:"пропустить текущий донат"}),t.map(n=>r.jsx(o,{donation:n}))]})]})}export{P as default};
